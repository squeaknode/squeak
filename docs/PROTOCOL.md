# Protocol

### Structures

#### squeak header

Field Size | Description | Data type | Comments
--- | --- | --- | ---
4 | nVersion | int32_t | Squeak version information
32 | hashEncContent | char[32] | The hash value of the encrypted content of the squeak
32 | hashReplySqk | char[32] | The hash value of the previous squeak in the conversation thread or null bytes if squeak is not a reply
32 | hashBlock | char[32] | The hash value of the latest block in the blockchain
4 | nBlockHeight | int32_t | The height of the latest block in the blockchain
1+ | script length | var_int | Length of the scriptPubKey
? | scriptPubKey | char[] | Usually contains the public key as a script setting up conditions to claim authorship.
162 | vchEncryptionKey | char[162] | The RSA public key of the squeak, as an RSA-1024 key
128 | vchEncDatakey | char[128] | The RSA-encrypted AES data key used to encrypt and decrypt the squeak content
16 | vchIv | char[16] | Random bytes used for the initialization vector
4 | nTime | uint32_t | A timestamp recording when this squeak was created
4 | nNonce | uint32_t | The nonce used to generate this squeak

#### squeak

A squeak has all of the fields of a squeak header plus the following:

Field Size | Description | Data type | Comments
--- | --- | --- | ---
1136 | vchEncContent | char[1136] | Encrypted content

#### squeak locator

Field Size | Description | Data type | Comments
--- | --- | --- | ---
4 | nVersion | uint32_t | The protocol version
? | count | var_int | Number of interested structs
? | interesteds | interested[] | Interested structs

#### interested

Field Size | Description | Data type | Comments
--- | --- | --- | ---
1+ | address length | var_int | Length of the address
? | address | char[] | The bytes of the public address identifying a squeak author or no bytes
4 | nMinBlockHeight | int32_t | The minimum block height or -1 to use no minimum
4 | nMaxBlockHeight | int32_t | The maximum block height or -1 to use no maximum
32 | hashReplySqk | char[32] | The hash value of the previous squeak in the conversation thread or null bytes

### Messages

#### msg_version
#### msg_verack
#### msg_addr
#### msg_inv
#### msg_getdata
#### msg_notfound
#### msg_getsqueaks

Field Size | Description | Data type | Comments
--- | --- | --- | ---
? | locator | squeak_locator | A single squeak locator struct

#### msg_getheaders

Field Size | Description | Data type | Comments
--- | --- | --- | ---
? | locator | squeak_locator | A single squeak locator struct

#### msg_headers

Field Size | Description | Data type | Comments
--- | --- | --- | ---
? | count | var_int | Number of squeak header structs
? | headers | squeak_header[] | Squeak header structs

#### msg_getaddr
#### msg_ping
#### msg_pong
#### msg_getoffer

Field Size | Description | Data type | Comments
--- | --- | --- | ---
4 | nOfferRequestId | uint32_t | Unique identifier of the offer request
32 | hashSqueak | char[32] | The hash value of the squeak
128 | vchChallenge | char[128] | Challenge string generated by encrypting a random string with the public RSA key of the squeak

#### msg_offer

Field Size | Description | Data type | Comments
--- | --- | --- | ---
4 | nOfferId | uint32_t | Unique identifier of the offer
4 | nOfferRequestId | uint32_t | Unique identifier of the offer request
? | squeak | char[1571] | The full squeak struct
32 | vchProof | char[32] | The decrypted challenge string, proving ownership of the RSA private key
1+ | script length | var_int | Length of the scriptSig
? | scriptSig | char[] | Computational Script for confirming authorship
4 | nPrice | uint32_t | The price of the squeak in satoshis

#### msg_getinvoice

Field Size | Description | Data type | Comments
--- | --- | --- | ---
4 | nOfferId | uint32_t | Unique identifier of the offer

#### msg_invoice

Field Size | Description | Data type | Comments
--- | --- | --- | ---
4 | nOfferId | uint32_t | Unique identifier of the offer
? | strPaymentInfo | var_str | The lightning payment info string for the invoice

#### msg_getfulfill

Field Size | Description | Data type | Comments
--- | --- | --- | ---
4 | nOfferId | uint32_t | Unique identifier of the offer

#### msg_fulfill

Field Size | Description | Data type | Comments
--- | --- | --- | ---
4 | nOfferId | uint32_t | Unique identifier of the offer
1+ | key length | var_int | Length of the decryption key
? | vchDecryptionKey | char[] | The RSA private key for the squeak
